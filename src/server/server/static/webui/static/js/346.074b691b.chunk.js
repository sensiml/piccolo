"use strict";(self.webpackChunksensiml_web=self.webpackChunksensiml_web||[]).push([[346],{46342:(e,a,t)=>{t.d(a,{A:()=>l});var s=t(65043),r=t(53193),n=t(67784),i=t(70579);const l=e=>{let{defaultValue:a,helperText:t,error:l,name:o,label:d,onChange:u,className:c,id:m,fullWidth:h=!0,isUpdateWithDefault:p=!0,isObserveDefaultValue:g=!1,...f}=e;const[b,x]=(0,s.useState)("");(0,s.useEffect)((()=>{void 0!==a&&(x(a),p&&u(o,a))}),[]),(0,s.useEffect)((()=>{void 0!==a&&g&&(x(a),g&&u(o,a))}),[a]);return(0,i.jsx)(r.A,{fullWidth:h,children:(0,i.jsx)(n.A,{id:m,className:c,value:b,label:d,error:l,onChange:e=>{var a;a=e.target.value,x(a),u(o,e.target.value)},helperText:t,...f})})}},99346:(e,a,t)=>{t.r(a),t.d(a,{default:()=>_});var s=t(97508),r=t(27802),n=t(20697),i=t(65043),l=t(94329),o=t(91688),d=t(97111),u=t(75342),c=t(96446),m=t(68903),h=t(63336),p=t(53193),g=t(77739),f=t(11906),b=t(41104),x=t(12200),A=t(69986),j=t(1577),v=t(18545),y=t(5766),C=t(46342),U=t(34294),D=t(33206),q=t(7478);const I=()=>(0,q.A)((e=>({root:{flexGrow:1},refreshBtn:{marginLeft:e.spacing(2)},mainHeader:{paddingLeft:10},formControl:{margin:e.spacing(1),minWidth:300,[e.breakpoints.up("lg")]:{maxWidth:1e3},[e.breakpoints.down("md")]:{maxWidth:600}},box:{minWidth:245,minHeight:400,paddingRight:20,display:"flex",flexDirection:"column"},grid:{maxWidth:1900},chartGrid:{padding:e.spacing(2),marginBottom:e.spacing(2)},fixedHeight:{margin:e.spacing(1),paddingTop:e.spacing(1),paddingBottom:e.spacing(5),height:320,minWidth:300},buttonWrapper:{display:"flex",gap:e.spacing(1),marginTop:e.spacing(2)},errorDiv:{marginTop:-22,minHeight:50},errorMessage:{color:e.palette.error.main},backdrop:{zIndex:e.zIndex.drawer+1,color:"#fff"},textFieldHide:{display:"none"},queryTextField:{marginTop:20}})))();var L=t(70579);const E=e=>{let{selectedProject:a,queries:t,sessions:s,labels:r,metadata:n,sources:q,addOrUpdateQuery:E,setHasUnsavedChanges:W}=e;const{projectUUID:_}=(0,o.useParams)(),S=(0,o.useHistory)(),O=I(),w={query:"",name:"",session:"",label:"",metadata:["segment_uuid"],source:[],plot:""},k=(0,i.useRef)(),[N,P]=(0,i.useState)(w),[R,V]=(0,i.useState)([]),{showMessageSnackbar:T}=(0,D.O4)(),H=e=>{W(e)},M=(e,a)=>{const t=N[e]!==a;P({...N,[e]:a}),H(t)};(0,i.useEffect)((()=>{P({...w})}),[a]),(0,i.useEffect)((()=>{0===n.filter((e=>"capture_uuid"===e.name)).length&&n.push({name:"capture_uuid"}),0===n.filter((e=>"segment_uuid"===e.name)).length&&n.push({name:"segment_uuid"}),V(b.A.sortObjects(n,"name",!0))}),[n]);const Q=()=>{S.push({pathname:(0,o.generatePath)(d.bw.MAIN.DATA_EXPLORER.child.QUERY_SCREEN.path,{projectUUID:_})})};return(0,L.jsxs)(A.A,{children:[(0,L.jsx)(c.A,{mb:2,children:(0,L.jsx)(j.A,{title:"Create Query",onClickBack:Q,turncateLenght:35,leftColumns:4,rightColumns:8,actionsBtns:(0,L.jsx)(U.U,{variant:"outlined",color:"primary",text:"CANCEL",tooltip:"CANCEL",onClick:Q,icon:(0,L.jsx)(u.A,{})})})}),(0,L.jsx)(m.Ay,{container:!0,spacing:2,justifyContent:"flex-start",children:(0,L.jsx)(m.Ay,{item:!0,xs:12,lg:7,xl:6,children:(0,L.jsx)(h.A,{elevation:0,children:(0,L.jsxs)(c.A,{p:2,children:[(0,L.jsx)(c.A,{mb:2,children:(0,L.jsx)(C.A,{label:"Query Name",id:"queryInput",name:"name",inputRef:k,isObserveDefaultValue:!0,isUpdateWithDefault:!1,onChange:M})}),(0,L.jsx)(c.A,{mb:2,children:(0,L.jsx)(v.A,{id:"sessions",labelId:"sessionsLabel",name:"session",label:"Session",onChange:M,isUpdateWithDefault:!1,isObserveDefaultValue:!0,defaultValue:N.session,options:s&&s.filter((e=>"SegmentID"!==e.name)).map((e=>({name:e.name,value:e.id})))})}),(0,L.jsx)(c.A,{mb:2,children:(0,L.jsx)(v.A,{id:"labelsList",labelId:"labels",name:"label",label:"Label",onChange:M,isUpdateWithDefault:!1,isObserveDefaultValue:!0,defaultValue:N.label,options:r&&r.filter((e=>"SegmentID"!==e.name)).map((e=>({name:e.name,value:e.name})))})}),(0,L.jsx)(c.A,{mb:2,children:(0,L.jsx)(y.A,{id:"metadataList",labelId:"metadataLabelId",name:"metadata",label:"Metadata",isUpdateWithDefault:!1,isObserveDefaultValue:!0,defaultValue:N.metadata||[],options:R&&R.map((e=>({name:e.name,value:e.name}))),onChange:M,disabledOptions:["segment_uuid"]})}),(0,L.jsx)(c.A,{mb:2,children:(0,L.jsx)(y.A,{id:"sourcesList",labelId:"sourcesListId",name:"source",label:"Source",isUpdateWithDefault:!1,isObserveDefaultValue:!0,defaultValue:N.source||[],options:q&&q.map((e=>({name:e,value:e}))),onChange:M})}),(0,L.jsx)(c.A,{mb:2,children:(0,L.jsx)(x.A,{value:N.metadata_filter||"",onChange:e=>{const a=N.metadata_filter!==e;P({...N,metadata_filter:e||""}),H(a)},queryMetada:N.metadata,queryLabel:N.label,isDisabled:!0})}),(0,L.jsx)(p.A,{fullWidth:!0,className:O.formControl,children:(0,L.jsx)(c.A,{className:O.buttonWrapper,children:(0,L.jsx)(p.A,{fullWidth:!0,children:(0,L.jsx)(g.A,{title:"Save",children:(0,L.jsx)(f.A,{variant:"contained",color:"primary",onClick:async()=>{a?N.name&&""!==N.name.trim()?t&&t.filter((e=>e.name.trim().toUpperCase()===N.name.trim().toUpperCase())).length>0?T("error","Query with the name '".concat(N.name,"' already exists. Please enter a new name.")):N.session?N.label?N.source&&0!==N.source.length?N.metadata&&0!==N.metadata.length?(H(!1),E(_,N.query,N.name,N.source,N.metadata,N.session,N.metadata_filter,N.label).then((e=>{e.isSuccessFull?S.push({pathname:(0,o.generatePath)(d.bw.MAIN.DATA_EXPLORER.child.QUERY_DETAILS_SCREEN.path,{projectUUID:a,queryUUID:e.newUuid})}):T("error",e.errorMessage)})).catch((e=>{const a=403===e.error.response.status?"Your account does not have permission to create or save a Query.":e.error;T("error",a)}))):T("error","Metadata are required to create a query."):T("error","Source columns are required to create a query."):T("error","Label is required to create a query."):T("error","Session is required to create a query."):T("error","Please enter a name for the query."):T("error","Project has to be selected to create a query.")},startIcon:(0,L.jsx)(l.A,{}),children:"Save"})})})})})]})})})})]})},W={addOrUpdateQuery:r.GE,setHasUnsavedChanges:n.OL},_=(0,s.Ng)((e=>{var a,t;return{selectedProject:e.projects.selectedProject.uuid,queries:e.queries.queryList.data||[],sessions:e.sessions.data,labels:e.labels.data,metadata:e.metadata.data,sources:e.sources.data,hasUnsavedChanges:(null===(a=e.common)||void 0===a||null===(t=a.values)||void 0===t?void 0:t.hasUnsavedChanges)||!1}}),W)(E)}}]);
//# sourceMappingURL=346.074b691b.chunk.js.map