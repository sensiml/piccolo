"use strict";(self.webpackChunksensiml_web=self.webpackChunksensiml_web||[]).push([[526],{57182:(e,t,a)=>{a.d(t,{A:()=>y});var s=a(65043),r=a(31952),i=a(11906),n=a(67254),l=a(40490),o=a(96446),c=a(7426),d=a(33206),u=a(81131),m=a(12490),h=a(7478);const p=()=>(0,h.A)((function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{...e.common,refreshBtn:{marginLeft:e.spacing(1)},actionPanel:{display:"flex",gap:e.spacing(1),marginTop:e.spacing(2)},actionButtons:{padding:"1px 0.5rem",marginLeft:e.spacing(1)},dismissButton:{color:e.palette.warning.main,borderColor:e.palette.warning.main}}}))();var g=a(70579);const y=e=>{let{title:t,isNewQuery:a,selectedQuery:h,queryCacheStatusData:y,loadQuery:x,onBuildCache:b,onDismiss:f,isButtonsPanel:A}=e;const{t:j}=(0,c.B)("queries"),v=p(),[C,q]=(0,s.useState)(""),[D,_]=(0,s.useState)(""),[L,S]=(0,s.useState)(!1),[E,w]=(0,s.useState)(!1),N=()=>{a?(q("info"),_(j("create-form.message-info")),S(!1)):y.status&&y.build_status===m.O.CACHED?(q("success"),_(y.message),S(!1)):y.status||y.build_status!==m.O.CACHED?y.build_status===m.O.BUILDING?(q("info"),_(y.message),w(!0),S(!0)):y.build_status===m.O.NOT_BUILT?(q("info"),_(y.message),S(!0)):y.build_status===m.O.FAILED&&(q("error"),_(y.message),S(!0)):(q("warning"),_(y.message),S(!0))},O=(0,s.useCallback)((()=>L),[L,y]);(0,d.$$)((async()=>{await void x(h)}),E?5e3:null),(0,s.useEffect)((()=>{N()}),[y,a,h]),(0,s.useEffect)((()=>{N()}),[]),(0,s.useEffect)((()=>{y.build_status!==m.O.BUILDING&&w(!1)}),[y]);const k=()=>{E||(b(h),w(!0))},T=()=>{E||f(h)},B=()=>(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(i.A,{id:"build_cache_btn","data-testid":"build_cache_btn",disabled:E,color:"primary",className:v.actionButtons,size:"small",onClick:k,variant:"outlined",children:j("cache.button-cache-rebuild")}),f?(0,g.jsx)(i.A,{id:"dismiss_btn","data-testid":"dismiss_btn",disabled:E||y.build_status===m.O.FAILED,className:"".concat(v.actionButtons," ").concat(v.dismissButton),color:"accent",size:"small",onClick:T,variant:"outlined",children:j("cache.button-cache-dismiss")}):null]});return D?(0,g.jsxs)(n.A,{variant:"outlined",severity:C,icon:E?(0,g.jsx)(r.A,{color:"primary",className:v.spinnedIcon}):null,children:[t?(0,g.jsx)(l.A,{children:t}):(0,g.jsx)(g.Fragment,{}),(0,g.jsx)("span",{children:D}),O()?A?(0,g.jsx)(o.A,{mt:1,ml:-1,children:B()}):B():null]}):(0,g.jsx)(u.HE,{isOpen:!1})}},89526:(e,t,a)=>{a.r(t),a.d(t,{default:()=>K});var s=a(97508),r=a(27802),i=a(20697),n=a(20433),l=a(42890),o=a(12826),c=a(65043),d=a(53536),u=a.n(d),m=a(94329),h=a(85502),p=a(91688),g=a(97111),y=a(69120),x=a(96446),b=a(68903),f=a(63336),A=a(53193),j=a(77739),v=a(11906),C=a(41104),q=a(90537),D=a(85865),_=a(7478),L=a(70579);const S=(0,_.A)((()=>({title:{paddingLeft:12}})));function E(e){const t=S();return(0,L.jsx)(D.A,{className:t.title,component:"h6",variant:"h6",gutterBottom:!0,align:"center",children:e.children})}const w=()=>(0,_.A)((()=>({plotGrid:{paddingLeft:15},tableGrid:{paddingRight:15}})))(),N={displayModeBar:!1,displaylogo:!1,responsive:!1},O="segment",k="samples",T=e=>{let{queryData:t,selectedPlotType:a,chartLabelColors:s}=e;const r=((e,t,a)=>{if(!t||C.A.isNullOrEmpty(t.label))return null;const s=(()=>{switch(e){case O:return t.segmentsCharts;case k:return t.samplesCharts;default:return null}})();if(!s)return null;const r={x:[],y:[],hovertemplate:"%{x}<br>".concat(u().capitalize(e)," : %{y:,d}<extra></extra>"),type:"bar",marker:{opacity:.8,...!u().isEmpty(a)&&a[0]&&{color:a}}};return Object.entries(s).forEach((e=>{let[t,a]=e;r.x.push(t),r.y.push(a)})),r})(a,t,s),i=w();return r?(0,L.jsxs)(b.Ay,{container:!0,className:i.plotGrid,direction:"row",alignItems:"center",spacing:0,children:[(0,L.jsx)(b.Ay,{item:!0,xs:12,children:(0,L.jsxs)(E,{children:[" Label Distribution by ",a," "]})}),(0,L.jsx)(b.Ay,{item:!0,xs:12,children:(0,L.jsx)(q.A,{style:{width:"100%",height:"100%"},data:[r],layout:{xaxis:{showgrid:!0,showline:!0,showticklabels:!0},yaxis:{showgrid:!0,showline:!0,tickformat:",d"},margin:{t:10,b:20,l:90,r:0},hoverlabel:{bgcolor:"#FFF",font:{color:"black"}},font:{family:"Arial, Helvetica, sans-serif",size:12,color:"#7f7f7f"},autosize:!0},useResizeHandler:!0,config:N,onLegendClick:()=>!1},"queryStatistics")})]}):(0,L.jsx)(D.A,{style:{paddingLeft:12},variant:"h5",children:"No Data to Display"})},B=(0,_.A)((()=>({title:{paddingLeft:12}})));function I(e){const t=B();return(0,L.jsx)(D.A,{className:t.title,component:"h6",variant:"h6",gutterBottom:!0,align:"center",children:e.children})}const Q=()=>(0,_.A)((()=>({plotGrid:{paddingLeft:15},tableGrid:{paddingRight:15}})))(),U={displayModeBar:!1,displaylogo:!1,responsive:!1};const R=function(e){let{queryData:t,chartLabelColors:a}=e;const s={xaxis:{showgrid:!0,showline:!0,showticklabels:!0,title:"Segment Sample Size"},yaxis:{showgrid:!0,showline:!0,tickformat:",d",title:"Count"},margin:{t:10,b:40,l:90,r:0},hoverlabel:{bgcolor:"#FFF",font:{color:"black"}},font:{family:"Arial, Helvetica, sans-serif",size:12,color:"#7f7f7f"},autosize:!0,barmode:"stack",...!u().isEmpty(a)&&{colorway:a}},r=(e=>{if(!e||C.A.isNullOrEmpty(e.label))return null;if(!e.segment_statistics)return null;const t=Object.keys(e.segment_statistics),a=[];for(let s=0;s<t.length;s++)a.push({x:e.segment_statistics[t[s]].x,y:e.segment_statistics[t[s]].histogram,type:"bar",name:t[s],marker:{opacity:.8}});return a})(t),i=Q();return r?(0,L.jsxs)(b.Ay,{container:!0,className:i.plotGrid,direction:"row",alignItems:"center",justifyContent:"center",spacing:0,children:[(0,L.jsx)(b.Ay,{item:!0,xs:12,children:(0,L.jsx)(I,{children:" Segment Length Distribution"})}),(0,L.jsx)(b.Ay,{item:!0,xs:12,children:(0,L.jsx)(q.A,{style:{width:"100%",height:"100%"},data:r,layout:s,useResizeHandler:!0,config:U},"querySegment")})]}):(0,L.jsx)(D.A,{style:{paddingLeft:12},variant:"h5",children:"No Data to Display"})};var F=a(12200),M=a(69986),W=a(57182),H=a(1577),P=a(18545),G=a(5766),z=a(33206),V=a(34815),X=a(34294),Y=a(81131);const $=()=>(0,_.A)((e=>({root:{flexGrow:1},refreshBtn:{marginLeft:e.spacing(2)},mainHeader:{paddingLeft:10},formControl:{margin:e.spacing(1),minWidth:300,[e.breakpoints.up("lg")]:{},[e.breakpoints.down("md")]:{maxWidth:600}},formControlButtons:{minWidth:300,[e.breakpoints.up("lg")]:{},[e.breakpoints.down("md")]:{maxWidth:600}},queryBox:{minWidth:245,minHeight:525,paddingRight:20,display:"flex",flexDirection:"column",justifyContent:"space-between"},queryForms:{display:"flex",flexDirection:"column"},grid:{maxWidth:1900},chartGrid:{padding:e.spacing(2),marginBottom:e.spacing(2)},fixedHeight:{margin:e.spacing(1),paddingTop:e.spacing(1),paddingBottom:e.spacing(5),height:320,minWidth:300},buttonWrapper:{display:"flex",gap:e.spacing(1),marginTop:e.spacing(2)},errorDiv:{marginTop:-22,minHeight:50},errorMessage:{color:e.palette.error.main},backdrop:{zIndex:e.zIndex.drawer+1,color:"#fff"},textFieldHide:{display:"none"},queryTextField:{marginTop:20}})))(),Z=e=>{let{selectedProject:t,selectedQuery:a,queryCacheStatusData:s,queries:r,sessions:i,labels:n,metadata:l,sources:o,queryDetails:d,hasUnsavedChanges:q,selectLabelValuesColors:D,loadQuery:_,setSelectedQuery:S,setPlot:E,buildQueryCache:w,clearQueryCacheStatus:N,addOrUpdateQuery:O,loadQueries:k,setHasUnsavedChanges:B,resetFeatureStats:I}=e;const{projectUUID:Q}=(0,p.useParams)(),{queryUUID:U}=(0,p.useParams)(),Z=(0,p.useHistory)(),J=$(),K={query:"",name:"",session:"",label:"",metadata:["segment_uuid"],source:[],plot:""},[ee,te]=(0,c.useState)(d&&d.data&&d.data.length>0?d.data:K),[ae,se]=(0,c.useState)(!1),[re,ie]=(0,c.useState)([]),[ne,le]=(0,c.useState)(!1),{showMessageSnackbar:oe}=(0,z.O4)();(0,z.G4)((e=>{le(e.innerWidth<V.xp.WIDTH_FOR_SHORT_TEXT)}));const ce=e=>{se(!1),oe("error",e),Z.push({pathname:(0,p.generatePath)(g.bw.MAIN.DATA_EXPLORER.child.QUERY_SCREEN.path,{projectUUID:t})})},de=async()=>{I(),_(Q,U).then((e=>{!1!==e.isSuccessFull||C.A.isNullOrEmpty(e.errorMessage)||ce(e.errorMessage),E("segment")})).catch((e=>{e&&ce(e.error.message)}))},ue=e=>{B(e)},me=(e,t)=>{const a=ee[e]!==t;te({...ee,[e]:t}),ue(a)},he=(0,c.useMemo)((()=>{const e=D(ee.label);return u().keys(ee.segment_statistics).map((t=>e[t]||""))}),[ee,n]),pe=(0,c.useCallback)((function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"segmentsCharts";const t=D(ee.label);return u().keys(ee[e]).map((e=>t[e]||""))}),[ee,n]);(0,c.useEffect)((()=>{Q!==t&&k(Q)}),[]),(0,c.useEffect)((()=>{se(d.isFetching),d&&d.data&&""===d.data.name||(te({...d.data}),se(d.isFetching),ue(!1))}),[d]),(0,c.useEffect)((()=>{te({...K})}),[t]),(0,c.useEffect)((()=>(S(U),de(),()=>N())),[]),(0,c.useEffect)((()=>{0===l.filter((e=>"capture_uuid"===e.name)).length&&l.push({name:"capture_uuid"}),0===l.filter((e=>"segment_uuid"===e.name)).length&&l.push({name:"segment_uuid"}),ie(C.A.sortObjects(l,"name",!0))}),[l]);const ge=()=>{Z.push({pathname:(0,p.generatePath)(g.bw.MAIN.DATA_EXPLORER.child.QUERY_SCREEN.path,{projectUUID:Q})})};return(0,L.jsxs)(M.A,{children:[(0,L.jsx)(x.A,{mb:2,children:(0,L.jsx)(H.A,{title:"Name: ".concat(ee.name),onClickBack:ne?null:ge,turncateLenght:ne?V.xp.TRUNCATE_NAME_OVER_SHORT_TEXT:V.xp.TRUNCATE_NAME_OVER,leftColumns:4,rightColumns:8,actionsBtns:(0,L.jsx)(L.Fragment,{children:(0,L.jsx)(X.bw,{variant:"outlined",color:"primary",onClick:()=>ge(),isShort:ne,tooltip:"Change Query",text:"Change Query",icon:(0,L.jsx)(y.A,{})})})})}),(0,L.jsxs)(b.Ay,{container:!0,spacing:2,children:[(0,L.jsx)(b.Ay,{item:!0,xs:12,lg:6,xl:6,children:(0,L.jsx)(f.A,{elevation:0,children:(0,L.jsxs)(x.A,{p:2,className:J.queryBox,children:[(0,L.jsx)(x.A,{mb:2,children:(0,L.jsx)(W.A,{queryData:ee,isNewQuery:!1,selectedQuery:U,queryCacheStatusData:s||{},loadQuery:()=>_(Q,U),onBuildCache:()=>{w(Q,U)}})}),(0,L.jsxs)(x.A,{className:J.queryForms,children:[(0,L.jsx)(x.A,{mb:2,children:(0,L.jsx)(P.A,{id:"sessionsList",labelId:"sessions",name:"session",label:"Session",onChange:me,isUpdateWithDefault:!1,isObserveDefaultValue:!0,defaultValue:ee.session,options:i&&i.map((e=>({name:e.name,value:e.id})))})}),(0,L.jsx)(x.A,{mb:2,children:(0,L.jsx)(P.A,{id:"labelsList",labelId:"labels",name:"label",label:"Label",onChange:me,isUpdateWithDefault:!1,isObserveDefaultValue:!0,defaultValue:ee.label,options:n&&n.filter((e=>"SegmentID"!==e.name)).map((e=>({name:e.name,value:e.name})))})}),(0,L.jsx)(x.A,{mb:2,children:(0,L.jsx)(G.A,{id:"metadataList",labelId:"metadataLabelId",name:"metadata",label:"Metadata",isUpdateWithDefault:!1,isObserveDefaultValue:!0,defaultValue:ee.metadata||[],options:re&&re.map((e=>({name:e.name,value:e.name}))),onChange:me,disabledOptions:["segment_uuid"]})}),(0,L.jsx)(x.A,{mb:2,children:(0,L.jsx)(G.A,{id:"sourcesList",labelId:"sourcesListId",name:"source",label:"Source",isUpdateWithDefault:!1,isObserveDefaultValue:!0,defaultValue:ee.source||[],options:o&&o.map((e=>({name:e,value:e}))),onChange:me})}),(0,L.jsx)(x.A,{mb:2,children:(0,L.jsx)(F.A,{value:ee.metadata_filter||"",onChange:e=>{const t=ee.metadata_filter!==e;te({...ee,metadata_filter:e||""}),ue(t)},queryMetada:ee.metadata,queryLabel:ee.label,isDisabled:!0})})]}),(0,L.jsx)(A.A,{fullWidth:!0,className:J.formControlButtons,children:(0,L.jsxs)(x.A,{className:J.buttonWrapper,children:[(0,L.jsx)(A.A,{fullWidth:!0,children:(0,L.jsx)(j.A,{title:"Save Changes",children:(0,L.jsx)(v.A,{variant:"contained",color:"primary",onClick:async()=>{t?ee.session?ee.label?ee.source&&0!==ee.source.length&&ee.metadata&&0!==ee.metadata.length?(se(!0),I(),O(Q,ee.query,ee.name,ee.source,ee.metadata,ee.session,ee.metadata_filter,ee.label).then((e=>{e.isSuccessFull?(se(!1),oe("success","Query '".concat(ee.name,"' saved successfully.")),ue(!1)):ce(e.errorMessage)})).catch((e=>{te({...ee,query:C.A.isNullOrEmpty(ee.query)?a||"":ee.query}),se(!1);const t=403===e.error.response.status?"Your account does not have permission to create or save a Query.":e.error;oe("error",t)}))):oe("error","Metadata and source columns are required to create a query."):oe("error","Label is required to create a query."):oe("error","Session is required to create a query."):oe("error","Project has to be selected to create a query.")},startIcon:(0,L.jsx)(m.A,{}),disabled:!q,children:"Save Changes"})})}),(0,L.jsx)(A.A,{fullWidth:!0,children:(0,L.jsx)(j.A,{title:"Cancel Changes",children:(0,L.jsx)(v.A,{variant:"contained",color:"primary",onClick:()=>{ee&&ee.query&&""!==ee.query?de(ee.query):r&&r.length>0?de(r[0].uuid):te(K),ue(!1),oe("warning","Your changes have been reverted.")},startIcon:(0,L.jsx)(h.A,{}),disabled:!q,children:"Cancel"})})})]})}),(0,L.jsx)(Y.HE,{isOpen:ae})]})})}),(0,L.jsx)(b.Ay,{item:!0,xs:12,lg:6,xl:6,children:(0,L.jsx)(f.A,{elevation:0,children:(0,L.jsx)(x.A,{p:2,className:J.queryBox,children:(0,L.jsx)(M.A,{children:(0,L.jsx)(R,{queryData:ee,chartLabelColors:he})})})})}),(0,L.jsx)(b.Ay,{item:!0,xs:12,xl:6,children:(0,L.jsx)(f.A,{elevation:0,children:(0,L.jsx)(x.A,{children:(0,L.jsx)(x.A,{className:J.chartGrid,children:(0,L.jsx)(M.A,{children:(0,L.jsx)(T,{queryData:ee,selectedPlotType:"segment",chartLabelColors:pe("segmentsCharts")})})})})})}),(0,L.jsx)(b.Ay,{item:!0,xs:12,xl:6,children:(0,L.jsx)(f.A,{elevation:0,children:(0,L.jsx)(x.A,{children:(0,L.jsx)(x.A,{className:J.chartGrid,children:(0,L.jsx)(M.A,{children:(0,L.jsx)(T,{queryData:ee,selectedPlotType:"samples",chartLabelColors:pe("samplesCharts")})})})})})})]})]})},J={loadQuery:r.rc,setPlot:l.c,loadQueries:r.P6,buildQueryCache:r.$1,clearQueryCacheStatus:r.QC,setSelectedQuery:r.iZ,setSelectedProject:n.NR,addOrUpdateQuery:r.GE,setHasUnsavedChanges:i.OL,resetFeatureStats:r.p4},K=(0,s.Ng)((e=>{var t,a,s,r;return{selectedProject:e.projects.selectedProject.uuid,selectedQuery:e.queries.selectedQuery,queryCacheStatusData:null===(t=e.queries)||void 0===t||null===(a=t.queryCacheStatus)||void 0===a?void 0:a.data,queries:e.queries.queryList.data||[],sessions:e.sessions.data,labels:e.labels.data,metadata:e.metadata.data,sources:e.sources.data,plots:e.plots.plotsData,queryDetails:e.queries.queryData,hasUnsavedChanges:(null===(s=e.common)||void 0===s||null===(r=s.values)||void 0===r?void 0:r.hasUnsavedChanges)||!1,selectLabelValuesColors:t=>(0,o.bi)(t)(e)}}),J)(Z)},31952:(e,t,a)=>{var s=a(24994);t.A=void 0;var r=s(a(40039)),i=a(70579);t.A=(0,r.default)((0,i.jsx)("path",{d:"M12 6v3l4-4-4-4v3c-4.42 0-8 3.58-8 8 0 1.57.46 3.03 1.24 4.26L6.7 14.8c-.45-.83-.7-1.79-.7-2.8 0-3.31 2.69-6 6-6m6.76 1.74L17.3 9.2c.44.84.7 1.79.7 2.8 0 3.31-2.69 6-6 6v-3l-4 4 4 4v-3c4.42 0 8-3.58 8-8 0-1.57-.46-3.03-1.24-4.26"}),"AutorenewOutlined")},40490:(e,t,a)=>{a.d(t,{A:()=>b});var s=a(58168),r=a(98587),i=a(65043),n=a(69292),l=a(68606),o=a(44350),c=a(34535),d=a(85865),u=a(57056),m=a(32400);function h(e){return(0,m.Ay)("MuiAlertTitle",e)}(0,u.A)("MuiAlertTitle",["root"]);var p=a(70579);const g=["className"],y=(0,o.h)("MuiAlertTitle"),x=(0,c.Ay)(d.A,{name:"MuiAlertTitle",slot:"Root",overridesResolver:(e,t)=>t.root})((e=>{let{theme:t}=e;return{fontWeight:t.typography.fontWeightMedium,marginTop:-2}})),b=i.forwardRef((function(e,t){const a=y({props:e,name:"MuiAlertTitle"}),{className:i}=a,o=(0,r.A)(a,g),c=a,d=(e=>{const{classes:t}=e;return(0,l.A)({root:["root"]},h,t)})(c);return(0,p.jsx)(x,(0,s.A)({gutterBottom:!0,component:"div",ownerState:c,ref:t,className:(0,n.A)(d.root,i)},o))}))}}]);
//# sourceMappingURL=526.015718c7.chunk.js.map