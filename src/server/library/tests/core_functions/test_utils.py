"""
Copyright 2017-2024 SensiML Corporation

This file is part of SensiML™ Piccolo AI™.

SensiML Piccolo AI is free software: you can redistribute it and/or
modify it under the terms of the GNU Affero General Public License
as published by the Free Software Foundation, either version 3 of
the License, or (at your option) any later version.

SensiML Piccolo AI is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public
License along with SensiML Piccolo AI. If not, see <https://www.gnu.org/licenses/>.
"""

import pytest
from pandas import DataFrame

from library.core_functions.utils.utils import get_costs


@pytest.mark.skip("TO BE FIXED")
class TestGetCosts:
    """Test get_costs function."""

    fixtures = ["cost_test.yml"]

    @pytest.fixture(autouse=True)
    def setup(self):
        self.feature_table = DataFrame(
            {
                "Category": {
                    0: "Sampling",
                    1: "Sampling",
                    2: "Sampling",
                    3: "Sampling",
                    4: "Sampling",
                    5: "Sampling",
                    6: "Sampling",
                    7: "Sampling",
                    8: "Sampling",
                    9: "Sampling",
                    10: "Sampling",
                    11: "Sampling",
                    12: "Sampling",
                    13: "Sampling",
                    14: "Sampling",
                    15: "Sampling",
                    16: "Sampling",
                    17: "Sampling",
                    18: "Sampling",
                    19: "Sampling",
                    20: "Sampling",
                    21: "Sampling",
                    22: "Sampling",
                    23: "Sampling",
                    24: "Sampling",
                    25: "Sampling",
                    26: "Sampling",
                    27: "Sampling",
                    28: "Sampling",
                    29: "Sampling",
                    30: "Sampling",
                    31: "Sampling",
                    32: "Sampling",
                    33: "Sampling",
                    34: "Sampling",
                    35: "Sampling",
                    36: "Statistical",
                    37: "Statistical",
                    38: "Statistical",
                    39: "Statistical",
                    40: "Statistical",
                    41: "Statistical",
                    42: "Statistical",
                    43: "Statistical",
                    44: "Statistical",
                    45: "Statistical",
                    46: "Statistical",
                    47: "Statistical",
                    48: "Statistical",
                    49: "Statistical",
                    50: "Statistical",
                    51: "Statistical",
                    52: "Statistical",
                    53: "Statistical",
                    54: "Statistical",
                    55: "Statistical",
                    56: "Statistical",
                    57: "Statistical",
                    58: "Statistical",
                    59: "Statistical",
                    60: "Statistical",
                    61: "Statistical",
                    62: "Statistical",
                    63: "Statistical",
                    64: "Statistical",
                    65: "Statistical",
                    66: "Statistical",
                    67: "Statistical",
                    68: "Statistical",
                    69: "Statistical",
                    70: "Statistical",
                    71: "Statistical",
                },
                "EliminatedBy": {
                    0: "",
                    1: "",
                    2: "",
                    3: "",
                    4: "",
                    5: "",
                    6: "",
                    7: "",
                    8: "",
                    9: "",
                    10: "",
                    11: "",
                    12: "",
                    13: "",
                    14: "",
                    15: "",
                    16: "",
                    17: "",
                    18: "",
                    19: "",
                    20: "",
                    21: "",
                    22: "",
                    23: "",
                    24: "",
                    25: "",
                    26: "",
                    27: "",
                    28: "",
                    29: "",
                    30: "",
                    31: "",
                    32: "",
                    33: "",
                    34: "",
                    35: "",
                    36: "",
                    37: "",
                    38: "",
                    39: "",
                    40: "",
                    41: "",
                    42: "",
                    43: "",
                    44: "",
                    45: "",
                    46: "",
                    47: "",
                    48: "",
                    49: "",
                    50: "",
                    51: "",
                    52: "",
                    53: "",
                    54: "",
                    55: "",
                    56: "",
                    57: "",
                    58: "",
                    59: "",
                    60: "",
                    61: "",
                    62: "",
                    63: "",
                    64: "",
                    65: "",
                    66: "",
                    67: "",
                    68: "",
                    69: "",
                    70: "",
                    71: "",
                },
                "Generator": {
                    0: "Downsample",
                    1: "Downsample",
                    2: "Downsample",
                    3: "Downsample",
                    4: "Downsample",
                    5: "Downsample",
                    6: "Downsample",
                    7: "Downsample",
                    8: "Downsample",
                    9: "Downsample",
                    10: "Downsample",
                    11: "Downsample",
                    12: "Downsample",
                    13: "Downsample",
                    14: "Downsample",
                    15: "Downsample",
                    16: "Downsample",
                    17: "Downsample",
                    18: "Downsample",
                    19: "Downsample",
                    20: "Downsample",
                    21: "Downsample",
                    22: "Downsample",
                    23: "Downsample",
                    24: "Downsample",
                    25: "Downsample",
                    26: "Downsample",
                    27: "Downsample",
                    28: "Downsample",
                    29: "Downsample",
                    30: "Downsample",
                    31: "Downsample",
                    32: "Downsample",
                    33: "Downsample",
                    34: "Downsample",
                    35: "Downsample",
                    36: "Median",
                    37: "Median",
                    38: "Median",
                    39: "Absolute Sum",
                    40: "Absolute Sum",
                    41: "Absolute Sum",
                    42: "Standard Deviation",
                    43: "Standard Deviation",
                    44: "Standard Deviation",
                    45: "Interquartile Range",
                    46: "Interquartile Range",
                    47: "Interquartile Range",
                    48: "25th Percentile",
                    49: "25th Percentile",
                    50: "25th Percentile",
                    51: "75th Percentile",
                    52: "75th Percentile",
                    53: "75th Percentile",
                    54: "Mean",
                    55: "Mean",
                    56: "Mean",
                    57: "Skewness",
                    58: "Skewness",
                    59: "Skewness",
                    60: "Absolute Mean",
                    61: "Absolute Mean",
                    62: "Absolute Mean",
                    63: "Kurtosis",
                    64: "Kurtosis",
                    65: "Kurtosis",
                    66: "100th Percentile",
                    67: "100th Percentile",
                    68: "100th Percentile",
                    69: "Sum",
                    70: "Sum",
                    71: "Sum",
                },
                "Selected": {
                    0: True,
                    1: True,
                    2: True,
                    3: True,
                    4: True,
                    5: True,
                    6: True,
                    7: True,
                    8: True,
                    9: True,
                    10: True,
                    11: True,
                    12: True,
                    13: True,
                    14: True,
                    15: True,
                    16: True,
                    17: True,
                    18: True,
                    19: True,
                    20: True,
                    21: True,
                    22: True,
                    23: True,
                    24: True,
                    25: True,
                    26: True,
                    27: True,
                    28: True,
                    29: True,
                    30: True,
                    31: True,
                    32: True,
                    33: True,
                    34: True,
                    35: True,
                    36: True,
                    37: True,
                    38: True,
                    39: True,
                    40: True,
                    41: True,
                    42: True,
                    43: True,
                    44: True,
                    45: True,
                    46: True,
                    47: True,
                    48: True,
                    49: True,
                    50: True,
                    51: True,
                    52: True,
                    53: True,
                    54: True,
                    55: True,
                    56: True,
                    57: True,
                    58: True,
                    59: True,
                    60: True,
                    61: True,
                    62: True,
                    63: True,
                    64: True,
                    65: True,
                    66: True,
                    67: True,
                    68: True,
                    69: True,
                    70: True,
                    71: True,
                },
                "Feature": {
                    0: "gen_0001_AccelerometerZ_00",
                    1: "gen_0001_AccelerometerZ_01",
                    2: "gen_0001_AccelerometerZ_02",
                    3: "gen_0001_AccelerometerZ_03",
                    4: "gen_0001_AccelerometerZ_04",
                    5: "gen_0001_AccelerometerZ_05",
                    6: "gen_0001_AccelerometerZ_06",
                    7: "gen_0001_AccelerometerZ_07",
                    8: "gen_0001_AccelerometerZ_08",
                    9: "gen_0001_AccelerometerZ_09",
                    10: "gen_0001_AccelerometerZ_10",
                    11: "gen_0001_AccelerometerZ_11",
                    12: "gen_0002_AccelerometerX_00",
                    13: "gen_0002_AccelerometerX_01",
                    14: "gen_0002_AccelerometerX_02",
                    15: "gen_0002_AccelerometerX_03",
                    16: "gen_0002_AccelerometerX_04",
                    17: "gen_0002_AccelerometerX_05",
                    18: "gen_0002_AccelerometerX_06",
                    19: "gen_0002_AccelerometerX_07",
                    20: "gen_0002_AccelerometerX_08",
                    21: "gen_0002_AccelerometerX_09",
                    22: "gen_0002_AccelerometerX_10",
                    23: "gen_0002_AccelerometerX_11",
                    24: "gen_0003_AccelerometerY_00",
                    25: "gen_0003_AccelerometerY_01",
                    26: "gen_0003_AccelerometerY_02",
                    27: "gen_0003_AccelerometerY_03",
                    28: "gen_0003_AccelerometerY_04",
                    29: "gen_0003_AccelerometerY_05",
                    30: "gen_0003_AccelerometerY_06",
                    31: "gen_0003_AccelerometerY_07",
                    32: "gen_0003_AccelerometerY_08",
                    33: "gen_0003_AccelerometerY_09",
                    34: "gen_0003_AccelerometerY_10",
                    35: "gen_0003_AccelerometerY_11",
                    36: "gen_0004_AccelerometerZMedian",
                    37: "gen_0005_AccelerometerXMedian",
                    38: "gen_0006_AccelerometerYMedian",
                    39: "gen_0007_AccelerometerZAbsSum",
                    40: "gen_0008_AccelerometerXAbsSum",
                    41: "gen_0009_AccelerometerYAbsSum",
                    42: "gen_0010_AccelerometerZStd",
                    43: "gen_0011_AccelerometerXStd",
                    44: "gen_0012_AccelerometerYStd",
                    45: "gen_0013_AccelerometerZIQR",
                    46: "gen_0014_AccelerometerXIQR",
                    47: "gen_0015_AccelerometerYIQR",
                    48: "gen_0016_AccelerometerZ25Percentile",
                    49: "gen_0017_AccelerometerX25Percentile",
                    50: "gen_0018_AccelerometerY25Percentile",
                    51: "gen_0019_AccelerometerZ75Percentile",
                    52: "gen_0020_AccelerometerX75Percentile",
                    53: "gen_0021_AccelerometerY75Percentile",
                    54: "gen_0022_AccelerometerZMean",
                    55: "gen_0023_AccelerometerXMean",
                    56: "gen_0024_AccelerometerYMean",
                    57: "gen_0025_AccelerometerZSkew",
                    58: "gen_0026_AccelerometerXSkew",
                    59: "gen_0027_AccelerometerYSkew",
                    60: "gen_0028_AccelerometerZAbsMean",
                    61: "gen_0029_AccelerometerXAbsMean",
                    62: "gen_0030_AccelerometerYAbsMean",
                    63: "gen_0031_AccelerometerZKurtosis",
                    64: "gen_0032_AccelerometerXKurtosis",
                    65: "gen_0033_AccelerometerYKurtosis",
                    66: "gen_0034_AccelerometerZ100Percentile",
                    67: "gen_0035_AccelerometerX100Percentile",
                    68: "gen_0036_AccelerometerY100Percentile",
                    69: "gen_0037_AccelerometerZSum",
                    70: "gen_0038_AccelerometerXSum",
                    71: "gen_0039_AccelerometerYSum",
                },
                "ContextIndex": {
                    0: 0,
                    1: 1,
                    2: 2,
                    3: 3,
                    4: 4,
                    5: 5,
                    6: 6,
                    7: 7,
                    8: 8,
                    9: 9,
                    10: 10,
                    11: 11,
                    12: 12,
                    13: 13,
                    14: 14,
                    15: 15,
                    16: 16,
                    17: 17,
                    18: 18,
                    19: 19,
                    20: 20,
                    21: 21,
                    22: 22,
                    23: 23,
                    24: 24,
                    25: 25,
                    26: 26,
                    27: 27,
                    28: 28,
                    29: 29,
                    30: 30,
                    31: 31,
                    32: 32,
                    33: 33,
                    34: 34,
                    35: 35,
                    36: 36,
                    37: 37,
                    38: 38,
                    39: 39,
                    40: 40,
                    41: 41,
                    42: 42,
                    43: 43,
                    44: 44,
                    45: 45,
                    46: 46,
                    47: 47,
                    48: 48,
                    49: 49,
                    50: 50,
                    51: 51,
                    52: 52,
                    53: 53,
                    54: 54,
                    55: 55,
                    56: 56,
                    57: 57,
                    58: 58,
                    59: 59,
                    60: 60,
                    61: 61,
                    62: 62,
                    63: 63,
                    64: 64,
                    65: 65,
                    66: 66,
                    67: 67,
                    68: 68,
                    69: 69,
                    70: 70,
                    71: 71,
                },
                "Sensors": {
                    0: "AccelerometerZ",
                    1: "AccelerometerZ",
                    2: "AccelerometerZ",
                    3: "AccelerometerZ",
                    4: "AccelerometerZ",
                    5: "AccelerometerZ",
                    6: "AccelerometerZ",
                    7: "AccelerometerZ",
                    8: "AccelerometerZ",
                    9: "AccelerometerZ",
                    10: "AccelerometerZ",
                    11: "AccelerometerZ",
                    12: "AccelerometerX",
                    13: "AccelerometerX",
                    14: "AccelerometerX",
                    15: "AccelerometerX",
                    16: "AccelerometerX",
                    17: "AccelerometerX",
                    18: "AccelerometerX",
                    19: "AccelerometerX",
                    20: "AccelerometerX",
                    21: "AccelerometerX",
                    22: "AccelerometerX",
                    23: "AccelerometerX",
                    24: "AccelerometerY",
                    25: "AccelerometerY",
                    26: "AccelerometerY",
                    27: "AccelerometerY",
                    28: "AccelerometerY",
                    29: "AccelerometerY",
                    30: "AccelerometerY",
                    31: "AccelerometerY",
                    32: "AccelerometerY",
                    33: "AccelerometerY",
                    34: "AccelerometerY",
                    35: "AccelerometerY",
                    36: "AccelerometerZ",
                    37: "AccelerometerX",
                    38: "AccelerometerY",
                    39: "AccelerometerZ",
                    40: "AccelerometerX",
                    41: "AccelerometerY",
                    42: "AccelerometerZ",
                    43: "AccelerometerX",
                    44: "AccelerometerY",
                    45: "AccelerometerZ",
                    46: "AccelerometerX",
                    47: "AccelerometerY",
                    48: "AccelerometerZ",
                    49: "AccelerometerX",
                    50: "AccelerometerY",
                    51: "AccelerometerZ",
                    52: "AccelerometerX",
                    53: "AccelerometerY",
                    54: "AccelerometerZ",
                    55: "AccelerometerX",
                    56: "AccelerometerY",
                    57: "AccelerometerZ",
                    58: "AccelerometerX",
                    59: "AccelerometerY",
                    60: "AccelerometerZ",
                    61: "AccelerometerX",
                    62: "AccelerometerY",
                    63: "AccelerometerZ",
                    64: "AccelerometerX",
                    65: "AccelerometerY",
                    66: "AccelerometerZ",
                    67: "AccelerometerX",
                    68: "AccelerometerY",
                    69: "AccelerometerZ",
                    70: "AccelerometerX",
                    71: "AccelerometerY",
                },
                "GeneratorIndex": {
                    0: 0,
                    1: 0,
                    2: 0,
                    3: 0,
                    4: 0,
                    5: 0,
                    6: 0,
                    7: 0,
                    8: 0,
                    9: 0,
                    10: 0,
                    11: 0,
                    12: 0,
                    13: 0,
                    14: 0,
                    15: 0,
                    16: 0,
                    17: 0,
                    18: 0,
                    19: 0,
                    20: 0,
                    21: 0,
                    22: 0,
                    23: 0,
                    24: 0,
                    25: 0,
                    26: 0,
                    27: 0,
                    28: 0,
                    29: 0,
                    30: 0,
                    31: 0,
                    32: 0,
                    33: 0,
                    34: 0,
                    35: 0,
                    36: 1,
                    37: 1,
                    38: 1,
                    39: 2,
                    40: 2,
                    41: 2,
                    42: 3,
                    43: 3,
                    44: 3,
                    45: 4,
                    46: 4,
                    47: 4,
                    48: 5,
                    49: 5,
                    50: 5,
                    51: 6,
                    52: 6,
                    53: 6,
                    54: 7,
                    55: 7,
                    56: 7,
                    57: 8,
                    58: 8,
                    59: 8,
                    60: 9,
                    61: 9,
                    62: 9,
                    63: 10,
                    64: 10,
                    65: 10,
                    66: 11,
                    67: 11,
                    68: 11,
                    69: 12,
                    70: 12,
                    71: 12,
                },
            }
        )

        self.median_sample_size = 173.0

    def test_get_costs(self):
        """Computes costs for a feature table and tests the results."""
        costs = get_costs(self.feature_table, self.median_sample_size)

        expected = {
            "100th Percentile": {
                "flash": 162.4,
                "latency": 17,
                "num_features": 3,
                "num_iterations": 3,
                "sram": 0.8,
                "stack": 260.0,
            },
            "25th Percentile": {
                "flash": 162.4,
                "latency": 519,
                "num_features": 3,
                "num_iterations": 3,
                "sram": 0.8,
                "stack": 260.0,
            },
            "75th Percentile": {
                "flash": 162.4,
                "latency": 0,
                "num_features": 3,
                "num_iterations": 3,
                "sram": 0.8,
                "stack": 260.0,
            },
            "Absolute Mean": {
                "flash": 172,
                "latency": 1896,
                "num_features": 3,
                "num_iterations": 3,
                "sram": 0,
                "stack": 108.0,
            },
            "Absolute Sum": {
                "flash": 140,
                "latency": 1855,
                "num_features": 3,
                "num_iterations": 3,
                "sram": 0,
                "stack": 108.0,
            },
            "Downsample": {
                "flash": 280,
                "latency": 2249,
                "num_features": 36,
                "num_iterations": 3,
                "sram": 0,
                "stack": 208.0,
            },
            "Interquartile Range": {
                "flash": 182.4,
                "latency": 519,
                "num_features": 3,
                "num_iterations": 3,
                "sram": 0.8,
                "stack": 268.0,
            },
            "Kurtosis": {
                "flash": 282.0,
                "latency": 70913,
                "num_features": 3,
                "num_iterations": 3,
                "sram": 0.0,
                "stack": 276.0,
            },
            "Mean": {
                "flash": 138.0,
                "latency": 1211,
                "num_features": 3,
                "num_iterations": 3,
                "sram": 0.0,
                "stack": 248.0,
            },
            "Median": {
                "flash": 354.4,
                "latency": 0,
                "num_features": 3,
                "num_iterations": 3,
                "sram": 0.8,
                "stack": 252.0,
            },
            "Skewness": {
                "flash": 294.0,
                "latency": 70982,
                "num_features": 3,
                "num_iterations": 3,
                "sram": 0.0,
                "stack": 276.0,
            },
            "Standard Deviation": {
                "flash": 278.0,
                "latency": 2439,
                "num_features": 3,
                "num_iterations": 3,
                "sram": 0.0,
                "stack": 304.0,
            },
            "Sum": {
                "flash": 88,
                "latency": 173,
                "num_features": 3,
                "num_iterations": 3,
                "sram": 0,
                "stack": 196.0,
            },
        }

        assert expected == costs
